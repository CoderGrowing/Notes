# 2. 寄存器

一个典型的CPU由运算器、控制器和寄存器等部件构成。部件之间也是通过总线相连。不同于CPU和芯片之间的总线，CPU内部的总线被称为**内部总线**，连接CPU和芯片的总线被称为**外部总线**。

寄存器是程序员可以操作用来读写数据的部件。对于8086CPU来说，它共有14个寄存器：AX、BX、CX、DX（通用寄存器）SI、DI、SP、BP（）IP、CS（）SS、DS、ES、PSW。

## 2.1 通用寄存器

通用寄存器用来存储一般性的数据内容。8086CPU的寄存器都是16位的，可以存放两个字节的数据。 AX、BX、CX、DX是8086CPU中的通用寄存器。

8086之前的CPU寄存器都是8位的，为了向后兼容，这四个通用寄存器都可以分为两个独立的寄存器来使用。

AX可分为AH和AL；BX可分为BH和BL…………

## 2.2 字的存储

8086可以一次处理两种尺寸的数据：

- 字节：即byte，一个字节由8个bit组成，可以存放在8位寄存器中
- 字：记为word，一个字由两个字节组成，分别为高位字节和低位字节

拿数字20000（4E20H）来说明数据在存储器中的存储状况。

| 寄存器    | 寄存器中的数据         | 所表示的值        |
| ------ | --------------- | ------------ |
| AX     | 100111000100000 | 20000(4E20H) |
| AH(高位) | 01001110        | 78(4EH)      |
| AL(低位) | 00100000        | 32(20H)      |

## 2.3 汇编指令

有了这么多基础知识，终于可以开始学习汇编指令了。下面是几条常用的指令：

| 汇编指令       | 控制CPU完成的操作         | 对应的高级语言描述 |
| ---------- | ------------------ | --------- |
| mov ax, 18 | 将18送入寄存器AX中        | AX = 18   |
| mov ah, 78 | 将78送入寄存器AH中        | AH = 78   |
| add ax, 8  | 将AX中的值加上8          | AX += 8   |
| mov ax, bx | 将寄存器BX中的数据送入AX中    | AX = BX   |
| add ax, bx | 将AX和BX数据相加，结果存入AX中 | AX += BX  |

注意汇编指令不区分大小写。

## 2.4 物理地址

CPU访问内存空间时需要给出内存空间的地址。不管是显存、内存还是其他存储器，在CPU中都一视同仁，拥有一个唯一的线性地址。这个唯一的地址就被称为物理地址。

#### 8086如何给出物理地址

8086CPU有20位地址总线，可寻址范围有$2^{20}$即1MB。但8086是16位结构，内部一次性处理、传输、暂存的地址只有16位。如何解决地址空间的差异呢？

8086采取了在内部用两位16位地址合成一个20位地址的方法。

这两个16位地址一个是**段地址**，一个是**偏移地址**。根绝下列公式来计算最终的物理地址：

**物理地址 = 段地址 * 16 + 偏移地址**。

## CS和IP

8086有4个段寄存器：CS、DS、SS和ES。顾名思义，段寄存器存放的就是段地址。

8086CPU最重要的寄存器是CS和IP，他们指定了当前要读取的指令的地址。CS是代码段寄存器，IP是指令指针寄存器。

任意时刻，8086从 CS * 16 + IP处读取一条指令并执行。也可以这样说：CPU将CS:IP处的内容当做指令执行。

#### 修改CS和IP

8086没有提供mov或者add指令修改CS和IP值的功能，修改这两个寄存器功能的指令为**转移指令**。转移指令中最简单的一个是jmp指令。

同时修改CS和IP：jmp 2AE3:3，执行后CS = 2AE3H，IP=0003H，CPU从2AE33H读取指令执行

仅修改IP："jmp 某一合法寄存器"，如"jmp ax"，此时CS值不变，IP值改为AX中的值。

#### 8086CPU的工作流程：

1. 从CS:IP指向的内存单元读取指令，读取的指令进入指令缓冲器
2. IP指向下一条指令
3. 执行指令，再次进行步骤一
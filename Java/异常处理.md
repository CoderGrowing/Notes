# 异常处理

### 1. 异常分类

Java中所有的异常类都继承自`Throwable`，它有两个直接子类：`Error`和`Exception`。其中`Error`类用来表示系统错误，由Java虚拟机抛出。通常我们进行程序设计时主要关注的是`Exception`类。`Exception`类有两个分支：`RuntimeException`和其他异常。由程序导致的错误属于`RuntimeException`，而由于I/O错误等原因导致的异常属于其他异常。

Java语言规范将派生于`Error`和`RuntimeException`类的异常称为**非受查（unchecked）异常**，将其他异常称之为**受查（checked）异常**。编译器将核查是否为所有的受查异常提供了异常处理器。

`Exception`类的几个常用方法：

- `public String toString()`：返回这个异常的描述
- `public void printStackTrace()`：输出Exception对象的异常描述，后面是一个栈跟踪，找到代码哪里出了问题。

### 2. 抛出异常

遇到了无法处理的情况，Java的方法应当抛出一个异常。在出错的地方，利用`throw`抛出指定的异常。另外，在可能抛出异常的方法中，可以在声明首部利用`throws`说明本方法可能抛出的异常类型：

```java
method() throws SomeExceptino {
    if (an error occurs) {
        throw new SomeException;
    }
}
```

那么什么时候应当在方法声明处声明可能要抛出的异常呢？先来看看什么时候应当抛出异常:

- 调用一个抛出受查异常的方法，如FileInputStream构造器时


- 程序运行过程中发现错误，并且利用throw语句抛出一个受查异常
- 程序出现错误，如访问不存在的下标时会抛出ArrayIndexOutOfBoundsException异常
- Java虚拟机和运行时库出现的内部错误


如果出现前两种情况之一，则必须告诉调用这个方法的程序员这里有可能抛出异常。即，**一个方法必须声明所有可能抛出的受查异常**，而对于非受查异常，应该想办法去解决，而不是说明这些错误可能出现。

如果在子类中覆盖了超类的一个方法，那么子类方法中声明的受查异常不能比超类中声明的异常更通用。如果超类中方法没有抛出任何异常，那么子类中的方法同样不能抛出任何受查异常。

### 4. 捕获异常

想要捕获一个异常，必须使用try...catch语句块：

```java
try {
    code here;
} catch (Exception e) {
    handler for this Exception
}
```

捕获多个异常：`try...catch(exception1)...catch(exception2)`
或者是：`try...catch(exception1 | exception2 e)`（多种异常处理方法相同时使用）。

#### finally子句

finally子句的用处在于确保资源的正常关闭。在try...catch块后使用finally子句可以执行无论发生异常与否都需要执行的动作。

注意，当finally子句中包含return语句时，在方法返回前finally子句就会执行，所以它会覆盖原方法的return语句。

#### try-with-resources

对于以下代码模式：

```java
open a resource
try {
    work with resource
} finally {
    close the resource
}
```

如果资源实现了AutoCloseable接口，那么资源可以自动关闭，我们可以写出更为简洁的代码：

```java
try (Resource res=...) {
    work with resources
}
```

Java会保证无论什么情况下资源都会被关闭。


### 5. 自定义异常

用户自定义异常需要从java.lang.Exception类继承。

```java
public class InputInvalidException extends Exception {
    public String toString() {
        System.out.println("Your input are invalid.")
    }
}
```

### 6. 断言

assert在Java中有两种形式：

- assert 条件;
- assert 条件:表达式;

例如想要断言x为非负值：

```java
assert x >= 0;
assert x >=0 : x；
```

默认情况下的assert是被禁用的，可以在运行程序时加入`-enableassertions`或者`-ea`选项启用。
## Bash Shell

### 1. bash 的内置命令：type

type 命令的作用在于查询一个命令是内置还是外部命令。

例：

```bash
type cd
# cd is a shell builtin

type ls
# ls is aliased to 'ls --color=tty'

type whereis
# whereis is /usr/bin/whereis
```

### 2. 变量

- 定义变量：`variable=test`
- 打印变量：`echo $variable`
- 包含特殊字符的变量值：v="test2 test4"（用单引号或者双引号括起来）
- 单引号中 $varaible 的形式会被当做普通文本，而双引号会把它当做变量看待
- 取消变量的设置：`unset variable`
- 变量转化为环境变量：export variable_name。注意普通变量在子进程中无法使用，转换成环境变量后才可以在子进程中使用。


#### 2.1 从键盘读取变量：read

read 命令可以从键盘读取用户输入并赋值给指定的变量。参数：

-p：后边接提示输入的语句

-t：需要等待的秒数，不会一直等待输入

```bash
read -p "Please input your name: " -t 10 name
# Sam Test
echo $name
# Sam Test
```

#### 2.2 声明变量类型：declare/typeset

declare 使用时若不接任何参数，bash 会输出所有的变量名称和内容，等同于 set。

参数：

-a：将后边的变量定义为数组（array）类型

-i：将后边的变量定义为整型

-x：用法同 export，将变量变为环境变量 

-r：将变量设为只读（readonly）类型

```bash
sum=1+1
echo $sum
# 1+1

declare -i sum=1+1
echo $sum
# 2
```

注意：变量默认类型是字符串；bash 环境的运算只能是整型，1/2 = 0。typeset 用法同 declare。

#### 2.3 修改变量内容

| 变量设置方式                | 作用                                                   |
| --------------------------- | ------------------------------------------------------ |
| ${variable# 要删除的关键字 }  | 从变量内容符合关键的开头开始往右删除，删除最短的匹配   |
| ${variable## 要删除的关键字 } | 同上，改为删除最长的匹配                               |
| ${variable% 关键字 }          | 若变量内容从后向前符合关键字，则最短匹配会被删除       |
| ${variable%% 关键字 }         | 同上，改为最长匹配被删除                               |
| ${ 变量 / 旧字符串 / 新字符串 }   | 若变量内容符合旧字符串，则第一个旧字符串被新字符串替换 |
| ${ 变量 // 旧字符串 / 新字符串 }  | 同上，全部替换                                         |

### 3. bash 的配置文件

1. 登陆欢迎信息：/etc/issue
2. 环境配置文件：

bash 首先会去读系统的配置文件：/etc/profile。读取完毕后再去读用户的配置文件，按照以下顺序：`~/.bash_profile`、`~/.bash_login`、`~/.profile`。读取到一个文件后即停止读取。

其中，`~/.bash_profile` 其实会去判断 `~/.bashrc`，若存在，则读入 `~/.bashrc` 的设置。

### 4. 数据流重定向

- 标准输入（stdin）：代码为 0，使用 < 或者 <<
- 标准输出（stdout）：代码为 1，使用 > 或者 >>
- 标准错误输出（stderr）：代码为 2，使用 2> 或者 2>>

需要注意的是，单个的 ">" 表示的是覆盖方式，">>" 表示的则是累加的方式。

```bash
ll /home > test     # 内容写入到 test 文件中
find / > result 2> err    # 将结果写入 result，错误写入 err

find / 2>&1 reslut       # 结果和错误写入同一个文件
find / &> result         # 同上
```

利用标准输入和标准输出可以将输出的信息存储到文件中。那么标准输入有什么用呢？

标准输入可以将原来需要由键盘输入的内容改由文件代替。单个 "<" 的使用

```bash
cat > file << "eof"
# > test
# > Ok
# > eof   输入后 cat 自行结束
cat file 
# test
# OK
```

### 5. 通配符和特殊符号

| 符号 | 含义                                                     |
| ---- | -------------------------------------------------------- |
| *    | 0 到无穷多个字符                                          |
| ?    | 一定有一个任意字符                                       |
| []   | 代表一定有一个在中括号内的字符，如[abcd]，一定是其中一个 |
| [-]  | 代表编码顺序内的所有字符，[0-9]                          |
| [^]  | [^abc]，非 abc 的字符                                      |

### 6. 一些命令 

#### 6.1 cut

作用：提取一行中的某一段信息。

参数：

-d：后面跟分隔字符，一定与 -f 一起使用

-f：根据 -d 的分隔字符将一段信息切割成数段，用 -f 取第几段

-c：以字符的单位取出固定的字符区间

 例：

```bash
echo $PATH | cut -d ":" -f 3, 5    # 取出 PATH 中第三和第五段内容，以：作为分隔符
echo $PATH | cut -c 3-5           # 取出 PATH 中第 3-5 个字符（无卵用，懒得找例子）
```

#### 6.2 grep

参数：

-a：将 binary 文件以 text 文件的方式查找数据

-c：计算找到 " 目标字符串 " 的个数

-i：忽略大小写的不同

-n：顺便输出行号

-v：反向选择，显示没有找到字符串的那行内容

#### 6.3 sort

参数：

-f：忽略大小写的差异

-b：忽略最前面的空格符部分

-M：以月份的名字来排序

-n：使用“纯数字”来进行排序（默认是文字类型排序）

-r：反向排序

-u：uniq，相同的数据中仅出现一行

-t：指定分隔符，默认以 tab 分隔

-k：以指定的区间进行排序

```bash
cat /etc/passwd | sort -t ":" -k 3 -n
# 以：作为分隔符，指定第三个字段作为排序依据，依照数字排序
```

#### 6.4 uniq

该命令可以将排序完成后的数据仅显示一次。

参数：

-i：忽略大小写

-c：进行计数

注意需要先 sort 后 uniq。

#### 6.5 wc

wc 命令用来统计数据的信息。

参数：

-l：列出有多少行

-w：列出有多少字（英文单词）

-m：多少字符

#### 6.6 双向重定向：tee

利用 tee 命令可以将数据流同时输出到屏幕和文件。

![](http://oqag5mdvp.bkt.clouddn.com/201803111745_180.png)

参数：

-a：以累加的方式，将数据加入到文件中

```bash
ls -l / | tee -a rootinfo | more # 同时显示在屏幕上和输出到文件
```

#### 6.7 字符串替换修改

##### 6.7.1 tr

参数：

-d：删除信息中的指定字符串

-s：替换掉重复的字符串

无参的时候默认执行替换操作。

```bash
last | tr [a-z] [A-Z]    # 将小写替换为大写
```

##### 6.7.2 col

参数：

-x：将 tab 键转换为对等的空格键

-b：在文字有反斜杠时，仅保留反斜杠最后接的字符



